<!DOCTYPE html>
<html>
<title>Wczesnośredniowieczne grodziska</title>
<head>
<!--tag responsywności-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--Link do biblioteki Leaflet-->
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<!--Link do biblioteki jQuey-->
<script src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<link rel='stylesheet prefetch' href='http://mrmufflon.github.io/Leaflet.Coordinates/dist/Leaflet.Coordinates-0.1.3.css'>
<script src='http://mrmufflon.github.io/Leaflet.Coordinates/dist/Leaflet.Coordinates-0.1.3.min.js'></script>
<style>
#map{
position: absolute;
display: block;
top: 0;
left: 0;
width: 100%;
height: 100%;
}
#panel{
position:fixed;
right: 7px;
top: 10px;
}
#menu{
background-color: white;
padding: 10px;
 width: 150px;
 border: solid 1px #c3c3c3;
 text-align: center;
}
#menu_res{
background-color: white;
 padding: 10px;
 width: 150px;
 border: solid 1px #c3c3c3;
 display: none;
}

</style>
</head>
<body>
<!--warstwa mapy-->
<div id="map"> </div>
<!--warstwa panelu-->
	<div id="panel">
<!--warstwa nagłówka menu-->
		<div id="menu" > Menu </div>
<!--warstwa zawartości menu-->
			<div id="menu_res">
				<div id="grodziska_84"><label><input type="checkbox" value="grodziska_84">grodziska</label></div>
				<div id="legenda1">
<!--adres dla legendy: trzeba podać własne nazwy warstw dla argumentu LAYER-->
					<img src="http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.1.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=grody:grodziska_84">
				</div>
<!--checkbox do włączania uzytków, tak samo dla pozostałych warstw-->
				<div id="powiaty_84"><label><input type="checkbox" value="powiaty_84">powiaty</label></div>
				<div id="legenda2">
<!--adres dla legendy-->
					<img src="http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.1.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=grody:powiaty_84">
				</div>
			</div>
	</div>
<script>



//definicja obiektu mapy z współrzędnymi dla wybranego obszaru
var map = L.map('map').setView([52.40, 16.90], 11);
//dodanie warstwy osm

var
mapbox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BYSA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
maxZoom: 18,
id: 'mapbox.light',
accessToken:'pk.eyJ1IjoiZ29zaWFrMTAiLCJhIjoiY2puY3ZoN2h0NXNuZTN4bjEzODhveTA4MCJ9.p6Vx-joA-4K-VZTSPOX93w'}).addTo(map);

//dodanie zmiennej adresu geoservera
var ms_url = "http://localhost:8080/geoserver/wms?";
//dodanie obiektu własnej warstwy geoserwera
var grodziska = L.tileLayer.wms(ms_url, {
	layers: 'grody:grodziska_84',
	format: 'image/png',
	transparent: true, //przeźroczystość
	opacity: 0.8
}).addTo(map);


var powiaty = L.tileLayer.wms(ms_url, {
//tu trzeba podać wg składni workspace:warstwa
	layers: 'grody:powiaty_84',
	format: 'image/png',
	transparent: true,
	opacity: 0.8
}).addTo(map);



$(document).ready(function(){
	$("#menu").click(function(){
		$("#menu_res").slideToggle("slow");
	});
});

$( "#menu_res" ).click(function( event ) {
	layerClicked = window[event.target.value];
		if (map.hasLayer(layerClicked)) {
			map.removeLayer(layerClicked);
		}
		else{
			map.addLayer(layerClicked);
		};
	});


//dodanie kontrolki skali mapy
L.control.scale().addTo(map);
//dodanie kontrolki pozycji myszki
L.control.coordinates({position:"bottomright"}).addTo(map);










//POPUPY

popup = new L.popup();
function onMapClick(e) {
	var BBOX = map.getBounds().toBBoxString();
	var WIDTH = map.getSize().x;
	var HEIGHT = map.getSize().y;
	var X = map.layerPointToContainerPoint(e.layerPoint).x;
	var Y = map.layerPointToContainerPoint(e.layerPoint).y;
	var qlayers='grody:grodziska_84';
	var URL =ms_url+'SERVICE=WMS&VERSION=1.1.1&REQUEST=GetFeatureInfo&LAYERS='+
		qlayers+'&QUERY_LAYERS='+qlayers+'&STYLES=&BBOX='+BBOX+'&FEATURE_COUNT=1&HEIGHT='
	+HEIGHT+'&WIDTH='+WIDTH+'&INFO_FORMAT=text%2Fhtml&SRS=EPSG%3A4326&X='+X+'&Y='+Y;
popup
.setLatLng(e.latlng)
.setContent(e.latlng.toString()+"<iframe src='"+URL+"'width='250' height='120' frameborder='0'></iframe>")
.openOn(map);
}
map.on("click", onMapClick);

</script>
</body>
</html>