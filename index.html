<!DOCTYPE html>
<html lang="pl">
<title>Wczesnośredniowieczne grodziska</title>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Responsive sidebar template with sliding effect and dropdown menu based on bootstrap 3">
<!-- MAPBOX -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
<!-- AJAX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>  
<script src="//rawgit.com/bassjobsen/Bootstrap-3-Typeahead/master/bootstrap3-typeahead.js"></script> 
<!-- LEAFLET -->
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<!-- SLIDER -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.2.0/bootstrap-slider.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.2.0/css/bootstrap-slider.min.css" />
<!-- Ajax-->
<script src="https://rawgit.com/calvinmetcalf/leaflet-ajax/gh-pages/dist/leaflet.ajax.js"></script>	
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

	<!--Bootstrap-->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script> 
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script> 


<link rel="stylesheet" href="css/style.css">

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

</head>
<body>
	<nav class="navigation">
        <div class="container">
        	<ul>
                <li class="iteam">
        	        <a href="glowna.html">Strona Główna</a>
                </li>
                <li class="iteam">
                	<a href="index.html">Mapa</a>
                </li>
            </ul>
        </div>
    </nav>
<!--warstwa mapy-->
<div class="container">
	<div id="map">
	<!--warstwa panelu-->
		<div class="panel">
	<!--warstwa nagłówka menu-->
			<div class="menu" type="button" class="btn btn-primary" > Menu </div>
	<!--warstwa zawartości menu-->
				<div class="wrapper">
				<div class="menu_res">
					<div id="grodziska_84"><label><input type="checkbox" value="grodziska_84">grodziska</label></div>
					<div id="legenda1">
	<!--adres dla legendy: trzeba podać własne nazwy warstw dla argumentu LAYER-->
						<img src="http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.1.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=grody:grodziska_84">
					</div>
	<!--checkbox do włączania uzytków, tak samo dla pozostałych warstw-->
					<div id="powiaty_84"><label><input type="checkbox" value="powiaty_84">powiaty</label></div>
					<div id="legenda2">
	<!--adres dla legendy-->
						<img src="http://localhost:8080/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.1.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=grody:powiaty_84">
					</div>
				</div>
		</div>
	</div>
</div>
<script>



//definicja obiektu mapy z współrzędnymi dla wybranego obszaru
var map = L.map('map').setView([52.40, 16.90], 11);
//dodanie warstwy mapbox

var
mapbox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BYSA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
maxZoom: 18,
id: 'mapbox.light',
accessToken:'pk.eyJ1IjoiZ29zaWFrMTAiLCJhIjoiY2puY3ZoN2h0NXNuZTN4bjEzODhveTA4MCJ9.p6Vx-joA-4K-VZTSPOX93w'}).addTo(map);

//adres geoservera
var ms_url = "http://localhost:8080/geoserver/wms?";
//dodanie grodziska
var grodziska = L.tileLayer.wms(ms_url, {
	layers: 'grody:grodziska_84',
	format: 'image/png',
	transparent: true,
	opacity: 0.8
}).addTo(map);


var powiaty = L.tileLayer.wms(ms_url, {
	layers: 'grody:powiaty_84',
	format: 'image/png',
	transparent: true,
	opacity: 0.8
}).addTo(map);



$(document).ready(function(){
	$("#menu").click(function(){
		$("#menu_res").slideToggle("slow");
	});
});

$( "#menu_res" ).click(function( event ) {
	layerClicked = window[event.target.value];
		if (map.hasLayer(layerClicked)) {
			map.removeLayer(layerClicked);
		}
		else{
			map.addLayer(layerClicked);
		};
	});
$(document).ready(function() {
$('#query').click(function() {
var setButton = document.getElementById('set');
 if ($('#query').is(':checked'))
setButton.addEventListener('click',query);
else
setButton.removeEventListener('click',query);
});
});
var clearButton = document.getElementById("clear");
clearButton.addEventListener('click'
, function(e) {
if(map.hasLayer(qlayer))map.removeLayer(qlayer);
});

//dodanie kontrolki skali mapy
L.control.scale().addTo(map);
//dodanie kontrolki pozycji myszki
L.control.coordinates({position:"bottomright"}).addTo(map);










//POPUPY

popup = new L.popup();
function onMapClick(e) {
	var BBOX = map.getBounds().toBBoxString();
	var WIDTH = map.getSize().x;
	var HEIGHT = map.getSize().y;
	var X = map.layerPointToContainerPoint(e.layerPoint).x;
	var Y = map.layerPointToContainerPoint(e.layerPoint).y;
	var qlayers='grody:grodziska_84';
	var URL =ms_url+'SERVICE=WMS&VERSION=1.1.1&REQUEST=GetFeatureInfo&LAYERS='+
		qlayers+'&QUERY_LAYERS='+qlayers+'&STYLES=&BBOX='+BBOX+'&FEATURE_COUNT=1&HEIGHT='
	+HEIGHT+'&WIDTH='+WIDTH+'&INFO_FORMAT=text%2Fhtml&SRS=EPSG%3A4326&X='+X+'&Y='+Y;
popup
.setLatLng(e.latlng)
.setContent(e.latlng.toString()+"<iframe src='"+URL+"'width='250' height='120' frameborder='0'></iframe>")
.openOn(map);
}
map.on("click", onMapClick);

</script>
</body>
</html>