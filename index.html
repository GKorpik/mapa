<!DOCTYPE html>
<html lang="pl">
<title>Wczesnośredniowieczne grodziska</title>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Responsive sidebar template with sliding effect and dropdown menu based on bootstrap 3">

<!-- MAPBOX -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
	
<!--JQuery  --> 
		
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
<!--Leaflet-->
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>   	

<link rel='stylesheet prefetch' href='http://mrmufflon.github.io/Leaflet.Coordinates/dist/Leaflet.Coordinates-0.1.3.css'>
<script src='http://mrmufflon.github.io/Leaflet.Coordinates/dist/Leaflet.Coordinates-0.1.3.min.js'></script>		
<!--Bootstrap-->
			
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script> 
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script> 


<link rel="stylesheet" href="css/style.css">


</head>
<body>
	<nav class="navigation">
        <div class="container">
        	<ul>
                <li class="iteam">
        	        <a href="glowna.html">Strona Główna</a>
                </li>
                <li class="iteam">
                	<a href="index.html">Mapa</a>
                </li>
            </ul>
        </div>
    </nav>
<!--warstwa mapy-->
<div class="container">
	<div id="map">
	<!--warstwa panelu-->
		<div id="panel">
	<!--warstwa nagłówka menu-->
			<div id="menu" class="menu btn btn-primary" > Menu </div>
	<!--warstwa zawartości menu-->
				<div id="opakowanie">
					<div id="przyciski">
						<button id="obszar" class="obszar btn" title="Wyświetlany powiat"></button> 
						<button id="ksztalt" class="ksztalt btn" title="Kształt grodziska"></button> 
					</div>
				</div>
		</div>
	</div>

	<div id="zasieg"  style="display:none">Wybór powiatu 
			<br>
			
				<select id="powiat"> 
					<option value=0>powiat chodzieski</option>
					<option value=1>powiat czarnkowsko-trzcianecki</option> 
					<option value=2>powiat gnieźnieński</option> 
					<option value=3>powiat gostyński</option> 
					<option value=4>powiat grodziski</option> 
					<option value=5>powiat jarociński</option> 
					<option value=6>powiat kaliski</option> 
					<option value=7>powiat Kalisz</option>
					<option value=8>powiat kępiński</option>
					<option value=9>powiat kolski</option>
					<option value=10>powiat Konin</option>
					<option value=11>powiat koniński</option>
					<option value=12>powiat kościański</option>
					<option value=13>powiat krotoszyński</option>
					<option value=14>powiat leszczyński</option>
					<option value=15>powiat Leszno</option>
					<option value=16>powiat międzychodzki</option>
					<option value=17>powiat nowotomyski</option>
					<option value=18>powiat obornicki</option>
					<option value=19>powiat ostrowski</option>
					<option value=20>powiat ostrzeszowski</option>
					<option value=21>powiat pilski</option>
					<option value=22>powiat pleszewski</option>
					<option value=23>powiat Poznań</option>
					<option value=24>powiat poznański</option>
					<option value=25>powiat rawicki</option>
					<option value=26>powiat słupecki</option>
					<option value=27>powiat szamotulski</option>
					<option value=28>powiat średzki</option>
					<option value=29>powiat śremski</option>
					<option value=30>powiat turecki</option>
					<option value=31>powiat wągrowiecki</option>
					<option value=32>powiat wolsztyński</option>
					<option value=33>powiat wrzesiński</option>
					<option value=34>powiat złotowski</option>
				</select> 
				<br>
				<button id="set" class="button btn" >przybliż</button> 
				<button id="clear" class="button btn">cofnij</button> 
		
			</div> 

			<div id="ksztalt_gr" style="display:none">Kształt grodziska
			<br>
				<select id="rodzaj" onchange="updatevariable(this.value)"> 
					<option value="pierscieniowate">pierścieniowate</option>
					<option value="stozkowate">stożkowate</option>  
					<option value="nieznane">nieznane</option> 
				</select>
				<br>
				<button id="set" class="button btn" onclick="przybliz()">przybliż</button> 
				<button id="clear" class="button btn" onclick="wymaz()">cofnij</button> 
			
			</div>

</div>


<script>
var funkcja_ii;


$(document).ready(function()
{ 
	$("#menu").click(function(){ 
		$("#ksztalt_gr").slideUp("fast"); 
		$("#zasieg").slideToggle("fast"); 
		$("#przyciski").slideToggle("slow"); 
		
	}); 
});	




$("#obszar").click(function()
{ 
	 
		$("#ksztalt_gr").slideUp("fast");
		$("#zasieg").slideToggle("slow"); 
				
}); 


$("#ksztalt").click(function()
{ 		
	$("#zasieg").slideUp("fast");
	$("#ksztalt_gr").slideToggle("slow");
}); 


$(document).ready(function()
{
    $('.popover-btn').popover();
});




//mapa
var map = L.map('map').setView([52.40, 16.90], 11);

var mapbox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
	maxZoom: 18,
	id: 'mapbox.light',
	accessToken:'pk.eyJ1IjoiZ29zaWFrMTAiLCJhIjoiY2puY3ZoN2h0NXNuZTN4bjEzODhveTA4MCJ9.p6Vx-joA-4K-VZTSPOX93w'});


mapbox.addTo(map);

//grodziska

var grody; 
var gs_url= "http://localhost:8080/geoserver/wms";

function grodzisko() {
	var defaultParam = { 
		service: 'WFS', 
		version: '1.3.0', 
		request: 'GetFeature', 
		typeName: 'grody:grodziska_84', 
		maxFeatures: 1000, 
		outputFormat: 'json', 
		format_options: 'callback:getJson', 
		srsName: 'epsg:4326',
	}; 
	var parameters = L.Util.extend(defaultParam); 
	var URL = gs_url + L.Util.getParamString(parameters);

	$.ajax ({ 
		url : URL,
		type: 'GET', 
		dataType : 'json', 
		jsonpCallback : 'getJson', 
		success : function (data) 
	{ 
	grody = L.geoJson(data, { 
		style: function (feature) { 
			return { color: "red", weight: 2 };
		}, 
		onEachFeature: function (feature, layer){
			var popup = new L.Popup();
			popup.setContent("<b>Nazwa</b><ul><li> " + feature.properties.nazwa + "<b>Opis</b><ul><li> " + feature.properties.opis +  "</li><li>Źródło: " + feature.properties.zrodlo + "</li></ul>");
			layer.bindPopup(popup);
		}
	}); 	 
		 
grody.addTo(map); 
		 
map.fitBounds(grody.getBounds());
	}
	}); 

}

grodzisko();


//filtorwanie po ksztalcis grodziska
function przybliz(){
	if(funkcja_ii == "pierscieniowate"){
		map.removeLayer(grody);
		$.ajax ({
			url :'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:pierscieniowate&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
			type : 'POST',
			dataType : 'json',
			jsonpCallback : 'getJson',
			success : function (data)
			{
				grody = L.geoJson(data, {
					style: function(feature) {
						return {color: "red", weight: 2};
					},
					onEachFeature: function(feature, layer){
						var popup = new L.Popup();
						popup.setContent("<b>Nazwa</b><ul><li> " + feature.properties.nazwa + "<b>Opis</b><ul><li> " + feature.properties.opis +  "</li><li>Źródło: " + feature.properties.zrodlo + "</li></ul>");
						layer.bindPopup(popup);
					}
				}).addTo(map);
				map.fitBounds(grody);
			}
		})
	}
	else if(funkcja_ii == "stozkowate"){
		map.removeLayer(grody);
		$.ajax ({
			url : 'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:stozkowate&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
			type : 'POST',
			dataType : 'json',
			jsonpCallback : 'getJson',
			success : function (data)
			{
				grody = L.geoJson(data, {
					style: function(feature) {
						return {color: "red", weight: 2};
					},
					onEachFeature: function(feature, layer){
						var popup = new L.Popup();
						popup.setContent("<b>Nazwa</b><ul><li> " + feature.properties.nazwa + "<b>Opis</b><ul><li> " + feature.properties.opis +  "</li><li>Źródło: " + feature.properties.zrodlo + "</li></ul>");
						layer.bindPopup(popup);
					}
				}).addTo(map);
				map.fitBounds(grody);
			}
		})
	}
	else if(funkcja_ii == 'nieznane'){
		map.removeLayer(grody);
		$.ajax ({
			url :'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:nieznane&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
			type : 'GET',
			dataType : 'json',
			jsonpCallback : 'getJson',
			success : function (data)
			{
				grody = L.geoJson(data, {
					style: function(feature) {
						return {color: "red", weight: 2};
					},
					onEachFeature: function(feature, layer){
						var popup = new L.Popup();
						popup.setContent("<b>Nazwa</b><ul><li> " + feature.properties.nazwa + "<b>Opis</b><ul><li> " + feature.properties.opis +  "</li><li>Źródło: " + feature.properties.zrodlo + "</li></ul>");
						layer.bindPopup(popup);
					}
				}).addTo(map);
				map.fitBounds(grody);
			}
		})
	}
	else{
		console.log('brak danych')
	}

}


function wymaz(){
	location.reload();
}




var powiat;
function powiaty() {

	$.ajax ({
		url :'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:powiaty_84&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
		type : 'GET',
		dataType : 'json',
		jsonpCallback : 'getJson',
		success : function (data)
		{
			powiat = L.geoJson(data, {
				style: function(feature) {
					return {color: "red", weight: 2};
				},
				onEachFeature: function(feature, layer){
				}
			}).addTo(map);
			map.fitBounds(powiat);
		}
	})
}







//dodanie kontrolki skali mapy
L.control.scale().addTo(map);
//dodanie kontrolki pozycji myszki
L.control.coordinates({position:"bottomright"}).addTo(map);


function updatevariable(data) {
	funkcja_ii = data;
}

</script>
</body>
</html>