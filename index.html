<!DOCTYPE html>
<html lang="pl">
<title>Wczesnośredniowieczne grodziska</title>
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Responsive sidebar template with sliding effect and dropdown menu based on bootstrap 3">

<!-- MAPBOX -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
	
<!--JQuery  --> 
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" />

		
<!--Leaflet-->
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>   	

<link rel='stylesheet prefetch' href='http://mrmufflon.github.io/Leaflet.Coordinates/dist/Leaflet.Coordinates-0.1.3.css'>
<script src='http://mrmufflon.github.io/Leaflet.Coordinates/dist/Leaflet.Coordinates-0.1.3.min.js'></script>		
<!--Bootstrap-->
			
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous"> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script> 
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script> 


<link rel="stylesheet" href="css/style.css">


</head>
<body>
	<nav class="navigation">
        <div class="container">
        	<ul>
                <li class="iteam">
        	        <a href="glowna.html">Strona Główna</a>
                </li>
                <li class="iteam">
                	<a href="index.html">Mapa</a>
                </li>
            </ul>
        </div>
    </nav>
<div class="container">
	<div id="map">
		<div id="panel">
			<div id="menu" class="btn btn-primary" > Menu </div>
				<div id="wrapper">
					<div id="przyciski">
						<button id="obszar" class="obszar btn" title="Wyświetlany powiat"></button> 
						<button id="ksztalt" class="ksztalt btn" title="Kształt grodziska"></button> 
						<div id="block"></div>
						<button id="wyszukiwarka" class="wyszukiwarka btn" title="Znajdź grodzisko"><a href="#wrapper" class="dropdown-toggle" data-toggle="dropdown"></a></button> 
						<button id="wiek" class="wiek btn" title="Wiek grodziska"><a href="#wrapper" class="dropdown-toggle" data-toggle="dropdown"></a></button> 
					</div>
				</div>
		</div>
	</div>


	<div id="zasieg"  style="display:none">Wybór powiatu 
			<br>
			
				<select id="powiat"> 
					<option value="powiat chodzieski">powiat chodzieski</option>
					<option value="powiat czarnkowsko-trzcianecki">powiat czarnkowsko-trzcianecki</option> 
					<option value="powiat gnieźnieński">powiat gnieźnieński</option> 
					<option value="powiat gostyński">powiat gostyński</option> 
					<option value="powiat grodziski">powiat grodziski</option> 
					<option value="powiat jarociński">powiat jarociński</option> 
					<option value="powiat kaliski">powiat kaliski</option> 
					<option value="powiat Kalisz">powiat Kalisz</option>
					<option value="powiat kępiński">powiat kępiński</option>
					<option value="powiat kolski">powiat kolski</option>
					<option value="powiat Konin">powiat Konin</option>
					<option value="powiat koniński">powiat koniński</option>
					<option value="powiat kościański">powiat kościański</option>
					<option value="powiat krotoszyński">powiat krotoszyński</option>
					<option value="powiat leszczyński">powiat leszczyński</option>
					<option value="powiat Leszno">powiat Leszno</option>
					<option value="powiat międzychodzki">powiat międzychodzki</option>
					<option value="powiat nowotomyski">powiat nowotomyski</option>
					<option value="powiat obornicki">powiat obornicki</option>
					<option value="powiat ostrowski">powiat ostrowski</option>
					<option value="powiat ostrzeszowski">powiat ostrzeszowski</option>
					<option value="powiat pilski">powiat pilski</option>
					<option value="powiat pleszewski">powiat pleszewski</option>
					<option value="powiat Poznań">powiat Poznań</option>
					<option value="powiat poznański">powiat poznański</option>
					<option value="powiat rawicki">powiat rawicki</option>
					<option value="powiat słupecki">powiat słupecki</option>
					<option value="powiat szamotulski">powiat szamotulski</option>
					<option value="powiat średzki">powiat średzki</option>
					<option value="powiat śremski">powiat śremski</option>
					<option value="powiat turecki">powiat turecki</option>
					<option value="powiat wągrowiecki">powiat wągrowiecki</option>
					<option value="powiat wolsztyński">powiat wolsztyński</option>
					<option value="powiat wrzesiński">powiat wrzesiński</option>
					<option value="powiat złotowski">powiat złotowski</option>
				</select> 
				<br>
				<button id="set2" class="button btn" >Przybliż</button> 
				<button id="clear2" class="button btn">Cofnij</button> 
		
	</div> 

			<div id="ksztalt_gr" style="display:none">Kształt grodziska
			<br>
				<select id="rodzaj" onchange="updatevariable(this.value)"> 
					<option value="pierscieniowate">pierścieniowate</option>
					<option value="stozkowate">stożkowate</option>  
					<option value="nieznane">nieznane</option> 
				</select>
				<br>
				<button id="set" class="button btn" onclick="przybliz()">Przybliż</button> 
				<button id="clear" class="button btn" onclick="wymaz()">Cofnij</button> 
			
			</div>

	<div id=wiek_gr style="display:none"> Wybór wieku
		<div id="chronologia">
			<input type="checkbox" value="V"><label>V</label>
			<input type="checkbox" value="VI"><label>VI</label>
		</div>
		<div id="chronologia">
			<input type="checkbox" value="VII"><label>VII</label>
			<input type="checkbox" value="VIII"><label>VIII</label>
		</div>
		<div id="chronologia">
			<input type="checkbox" value="IX"><label>IX</label>
			<input type="checkbox" value="X"><label>X</label>
		</div>
		<div id="chronologia">
			<input type="checkbox" value="XI"><label>XI</label>
			<input type="checkbox" value="XIII"><label>XIII</label>
		</div>
		<div id="chronologia">
			<input type="checkbox" value="XIV"><label>XIV</label>
			<input type="checkbox" value="XV"><label>XV</label>
		</div>
		<div id="chronologia">
			<input type="checkbox" value="XVI"><label>XVI</label>
			<input type="checkbox" value="XVII"><label>XVII</label>
		</div>
		<button id="search" class="button btn" >Szukaj</button>
		<button id="clear3" class="button btn">Cofnij</button> 
	</div>
	
	<div id=wyszukaj style="display:none"> Znajdź grodzisko
		<input type="text" id="wstaw">
		<button id="search1" class="button btn">Szukaj</button> 
	</div>
</div>



<script>

$(document).ready(function()
{ 
	$("#menu").click(function(){ 
		$("#ksztalt_gr").slideUp("fast"); 
		$("#zasieg").slideUp("fast");
		$("#wiek_gr ").slideUp("fast"); 
		$("#wyszukaj").slideUp("fast"); 
		$("#przyciski").slideToggle("slow"); 
		
	}); 
});	




$("#obszar").click(function()
{ 
		$("#wiek_gr ").slideUp("fast"); 
		$("#wyszukaj").slideUp("fast"); 
		$("#ksztalt_gr").slideUp("fast");
		$("#zasieg").slideToggle("slow"); 
				
}); 


$("#ksztalt").click(function()
{ 	
	$("#wiek_gr ").slideUp("fast"); 
	$("#wyszukaj").slideUp("fast"); 	
	$("#zasieg").slideUp("fast");
	$("#ksztalt_gr").slideToggle("slow");
}); 

$("#wyszukiwarka").click(function()
{ 	
	$("#wiek_gr ").slideUp("fast"); 
	$("#wyszukaj").slideToggle("slow"); 	
	$("#zasieg").slideUp("fast");
	$("#ksztalt_gr").slideUp("fast");
}); 

$("#wiek").click(function()
{ 	
	$("#wiek_gr ").slideToggle("slow"); 
	$("#wyszukaj").slideUp("fast"); 	
	$("#zasieg").slideUp("fast");
	$("#ksztalt_gr").slideUp("fast");
}); 




//mapa
var map = L.map('map').setView([52.40, 16.90], 11);
var mapbox = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
	maxZoom: 18,
	id: 'mapbox.light',
	accessToken:'pk.eyJ1IjoiZ29zaWFrMTAiLCJhIjoiY2puY3ZoN2h0NXNuZTN4bjEzODhveTA4MCJ9.p6Vx-joA-4K-VZTSPOX93w'});
mapbox.addTo(map);

//grodziska
var grody; 

var gs_url= "http://localhost:8080/geoserver/wms";
function grodzisko() {
	var defaultParam = { 
		service: 'WFS', 
		version: '1.3.0', 
		request: 'GetFeature', 
		typeName: 'grody:grodziska_84', 
		maxFeatures: 1000, 
		outputFormat: 'json', 
		format_options: 'callback:getJson', 
		srsName: 'epsg:4326',
	}; 
	var parameters = L.Util.extend(defaultParam); 
	var URL = gs_url + L.Util.getParamString(parameters);
	$.ajax ({ 
		url : URL,
		type: 'GET', 
		dataType : 'json', 
		jsonpCallback : 'getJson', 
		success : function (data) 
	{ 
	var ikona = L.icon({
		iconUrl: 'css/castle1.png',
		iconSize: [20, 20]
	});

	grody = L.geoJson(data, { 
		pointToLayer: function (feature, latlng) { 
			return L.marker(latlng,{icon:ikona});
		}, 
		onEachFeature: function (feature, layer){
			var popup = new L.Popup();
			popup.setContent(feature.properties.nazwa + "</li><li><b>Opis:</b> " + feature.properties.opis +  "</li><li><b>Wiek:</b> " + feature.properties.informacje + "</li><li><b>Źródło:</b> " + feature.properties.zrodlo + "</li></ul>");
			layer.bindPopup(popup);
		}
	});
		 
grody.addTo(map); 



		 
map.fitBounds(grody.getBounds());
	}
	}); 
}
grodzisko();



//filtorwanie po ksztalcie grodziska
var funkcja_ii;

function przybliz(){
	if(funkcja_ii == "pierscieniowate"){
		map.removeLayer(grody);
		$.ajax ({
			url :'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:pierscieniowate&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
			type : 'POST',
			dataType : 'json', 
			jsonpCallback : 'getJson',
			success : function (data)
			{
				grody = L.geoJson(data, {
					style: function(feature) {
						return {color: "red", weight: 2};
					},
					onEachFeature: function(feature, layer){
						var popup = new L.Popup();
						popup.setContent(feature.properties.nazwa + "</li><li><b>Opis:</b> " + feature.properties.opis + "</li><li><b>Wiek:</b> " + feature.properties.informacje + "</li><li><b>Źródło:</b> " + feature.properties.zrodlo + "</li></ul>");
						layer.bindPopup(popup);
					}
				}).addTo(map);
				map.fitBounds(grody);
			}
		})
	}
	else if(funkcja_ii == "stozkowate"){
		map.removeLayer(grody);
		$.ajax ({
			url : 'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:stozkowate&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
			type : 'POST',
			dataType : 'json',
			jsonpCallback : 'getJson',
			success : function (data)
			{
				grody = L.geoJson(data, {
					style: function(feature) {
						return {color: "red", weight: 2};
					},
					onEachFeature: function(feature, layer){
						var popup = new L.Popup();
						popup.setContent(feature.properties.nazwa + "</li><li><b>Opis:</b> " + feature.properties.opis +  "</li><li><b>Wiek:</b> " + feature.properties.informacje + "</li><li><b>Źródło:</b> " + feature.properties.zrodlo + "</li></ul>");
						layer.bindPopup(popup);
					}
				}).addTo(map);
				map.fitBounds(grody);
			}
		})
	}
	else if(funkcja_ii == 'nieznane'){
		map.removeLayer(grody);
		$.ajax ({
			url :'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:nieznane&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
			type : 'GET',
			dataType : 'json',
			jsonpCallback : 'getJson',
			success : function (data)
			{
				grody = L.geoJson(data, {
					style: function(feature) {
						return {color: "red", weight: 2};
					},
					onEachFeature: function(feature, layer){
						var popup = new L.Popup();
						popup.setContent(feature.properties.nazwa + "</li><li><b>Opis:</b> " + feature.properties.opis + "</li><li><b>Wiek:</b> " + feature.properties.informacje + "</li><li><b>Źródło:</b> " + feature.properties.zrodlo + "</li></ul>");
						layer.bindPopup(popup);
					}
				}).addTo(map);
				map.fitBounds(grody);
			}
		})
	}
	else{
		console.log('brak danych')
	}
}
function wymaz(){
	location.reload();
}



//wszystkie powiaty
var powiat;
function powiaty() {
	$.ajax ({
		url :'http://localhost:8080/geoserver/grody/wfs?service=WFS&version=1.3.0&typename=grody:powiaty_84&request=GetFeature&typeNames=featuretype&outputFormat=application/json',
		type : 'GET',
		dataType : 'json',
		jsonpCallback : 'getJson',
		success : function (data)
		{
			powiat = L.geoJson(data, {
				style: function(feature) {
					return {color: 'black', fillColor: 'transparent', weight: 2};
				},
				onEachFeature: function(feature, layer){
				}
			}).addTo(map);
			map.fitBounds(powiat);
		}
	})
}

powiaty();

//filtrowanie po powiatach

var powiaty_84;

function zasieg(){
	if(map.hasLayer(powiaty_84))map.removeLayer(powiaty_84);
	nazwa=$("#powiat").val();  

	var viewparams = ['nazwa:' + nazwa];
	var defaultParam = {
		service: 'WFS',
		version: '1.3.0',
		request: 'GetFeature',
		typeName: ' grody:powiaty',
		maxFeatures: 1000,
		outputFormat: 'json',
		format_options: 'callback:getJson',
		srsName: 'epsg:4326',
		viewparams:  viewparams.join(';')
	};
var parameters = L.Util.extend(defaultParam);
var URL = gs_url + L.Util.getParamString(parameters);

$.ajax({
	url : URL,
	type: 'GET',
	dataType : 'json',
	jsonpCallback : 'getJson',
	success : function (data) {
		powiaty_84 = L.geoJson(data, {
			style: function (feature) {
				return {
					color: 'black',
					fillColor: 'transparent',
					weight: 1
		};},
		onEachFeature: function (feature, layer) {
			map.fitBounds(layer.getBounds()); 
		}

	});
	powiaty_84.addTo(map);
}});
}

zasieg();



var setButton2 = document.getElementById('set2'); 
setButton2.addEventListener('click', zasieg);


function czysc2(d)
{
	if(map.hasLayer(powiaty_84))map.removeLayer(powiaty_84);
	map.fitBounds(powiat.getBounds());
	
}

var clearButton2 = document.getElementById('clear2'); 
clearButton2.addEventListener('click', czysc2);





//wiek

// funkcja resetująca  filtrowanie po feature 
function setFeaturesVisible() {
	for(let key in grody._layers) {
		const feature = grody._layers[key]._layers
			for(let key2 in feature) {
			feature[key2].setOpacity(1) //nieprzezroczyste
			}
	}
}

var clearButton3 = document.getElementById('clear3'); 
clearButton3.addEventListener('click', setFeaturesVisible);


function getCheckedCheckboxes() {
	const checkedBoxes = []
	$("input:checkbox[type=checkbox]:checked").each(function(){ //wybieramy zaznaczone checkboxy
    checkedBoxes.push($(this).val());
});
	return checkedBoxes
}

function filterByAges(checkedBoxes) {
	for(let key in grody._layers) {
		const feature = grody._layers[key]
		console.log(feature)
		const wieki = feature.feature.properties.informacje
		const wiekiArray = wieki.split(' ') // string wieki na tablice
var hasCommonAges = wiekiArray.filter(function(e) { // zwraca liste wspólnych wieków
  return checkedBoxes.indexOf(e) > -1;
})
		if(hasCommonAges.length === 0) {
			for(let key2 in feature._layers) {
			feature._layers[key2].setOpacity(0) // przezroczyste
			}
		}
	}
}

var setButton3 = document.getElementById('search'); 
setButton3.addEventListener('click', () => {
	setFeaturesVisible()
	const checkedBoxes = getCheckedCheckboxes()
	if(checkedBoxes.length) {
	filterByAges(checkedBoxes)
	}
});






/*
//wyszukiwarka

var wyszukaj;

function wyszukiwarka(){
	if(map.hasLayer(wyszukaj))map.removeLayer(wyszukaj);
	nazwa=$("#wyszukiwarka").val();  

	var viewparams = ['nazwa:' + nazwa];
	var defaultParam = {
		service: 'WFS',
		version: '1.3.0',
		request: 'GetFeature',
		typeName: ' grody:wyszukiwarka',
		maxFeatures: 1000,
		outputFormat: 'json',
		format_options: 'callback:getJson',
		srsName: 'epsg:4326',
		viewparams:  viewparams.join(';')
	};
var parameters = L.Util.extend(defaultParam);
var URL = gs_url + L.Util.getParamString(parameters);

$.ajax({
	url : URL,
	type: 'GET',
	dataType : 'json',
	jsonpCallback : 'getJson',
	success : function (data) {
		wyszukaj = L.geoJson(data, {
			style: function (feature) {
				return {
					color: 'black',
					fillColor: 'transparent',
					weight: 1
		};},
		onEachFeature: function (feature, layer) {
			map.fitBounds(layer.getBounds()); 
		}

	});
	wyszukaj.addTo(map);
}});
}

wyszukiwarka();

var setButton3 = document.getElementById('search1'); 
setButton3.addEventListener('click', wyszukiwarka);


$( function() {
    $( "#wstaw" ).autocomplete({
      source: 'php/index.php'
    });
});	


*/
//dodanie kontrolki skali mapy
L.control.scale().addTo(map);
//dodanie kontrolki pozycji myszki
L.control.coordinates({position:"bottomright"}).addTo(map);
function updatevariable(data) {
	funkcja_ii = data;
}


</script>
</body>
</html>